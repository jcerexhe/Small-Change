<% provide(:title, "Trending Articles") %>

<div class="container">
  <div class="col-xs-12 col-sm-10 col-sm-offset-1">
    <h2 class="page-heading">Trending Articles</h2>
    <%= link_to "Most Actioned", submissions_path(most_actioned: true), class: (params[:most_actioned] || !params[:most_actioned] && !params[:most_recent] ? 'btn btn-black' : 'btn btn-black-default') %>
    <%= link_to "Most Recent", submissions_path(most_recent: true), class: (params[:most_recent] ? 'btn btn-black' : 'btn btn-black-default') %>
    <div class="row featured-cards">
      <% @submissions.each do |submission| %>
        <div class="col-xs-12 col-sm-6 col-md-4 card-block">
          <a href="<%= submission_path(submission) %>">
            <div class="card index-card">
              <img class="card-img-top" src="<%= submission.image %>" width="100%" height="180px" alt="<%= submission.title %>">
              <div class="card-block">
                <div class="row">
                  <div class="col-xs-12">
                    <h4 id="card-title"><%= truncate(submission.title, length: 55) %></h4>
                    <p id="card-text"><%= strip_url(submission.url) %></p>
                  </div>
                </div>
                <% if submission.submission_type == "petition" %>
                  <h5 id="card-clicks"><span class="badge"><%= submission.link_clicks %></span> Signatures</h5> 
                  <% else %>
                  <h5 id="card-clicks"><span class="badge">$<%= @donations.where(submission_id: submission.id).sum(:amount).to_i %></span> Raised</h5> 
                <% end %>
                <footer>
                  <h5 id="card-views"><%= submission.impressionist_count %> Views</h5>
                  <span><%= link_to "Take Action", submission_path(submission.id), class: 'btn btn-black-trending pull-right' %></span>
                </footer>
              </div>
            </div>
          </a>
        </div>
      <% end %>
    </div>
  </div>
</div>
<div class="text-center">
  <button class="more-cards btn btn-black"><i class="fa fa-chevron-down"></i> More</button>
</div>

<script>

  $('.card-block:gt(11)').hide();
  $('.more-cards').click(function() {
    $('.card-block:gt(11)').show();
    $('.more-cards').hide();
  });

</script>

